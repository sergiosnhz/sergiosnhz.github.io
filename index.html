<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Evaluación - Tendones Flexores</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Corrección de márgenes más amplios */
        .container {
            max-width: 1400px !important;
            margin: 0 auto;
            padding: 20px 40px !important;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)) !important;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .col-span-2 {
            grid-column: span 2;
        }
        
        /* Mejora de goniometría */
        .goniometry-grid {
            display: grid;
            grid-template-columns: 150px repeat(3, 120px);
            gap: 8px;
            max-width: 600px;
            margin: 20px 0;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
        }
        
        .gonio-header {
            background: #2c5aa0;
            color: white;
            padding: 10px 8px;
            text-align: center;
            font-weight: bold;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .gonio-label {
            background: #e8f2ff;
            padding: 10px 8px;
            text-align: center;
            font-weight: 500;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .gonio-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
            max-width: 100%;
        }
        
        .gonio-input:focus {
            border-color: #2c5aa0;
            outline: none;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.2);
        }
        
        /* Estilo para botones de edición */
        .edit-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin: 2px;
        }
        
        .edit-button:hover {
            background: #218838;
        }
        
        /* Mejores espacios en las tarjetas */
        .card {
            margin-bottom: 25px !important;
            padding: 25px !important;
        }
        
        .card-body {
            padding: 20px 0 !important;
        }
        
        /* Espaciado mejorado para secciones clínicas */
        .clinical-history-item {
            margin-bottom: 20px;
            padding: 20px;
        }
        
        .clinical-data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        /* Estilos para modales de edición */
        .edit-modal {
            max-width: 900px;
            width: 90vw;
        }
        
        .edit-followups-container {
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .edit-followup-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f9f9f9;
        }
        
        .edit-followup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .edit-followup-summary {
            font-size: 14px;
            color: #666;
        }
        
        .edit-followup-summary p {
            margin: 5px 0;
        }
        
        .add-followup-section {
            text-align: center;
            padding: 20px;
            border-top: 1px solid #ddd;
        }
        
        /* Responsividad mejorada */
        @media (max-width: 768px) {
            .container {
                padding: 15px 20px !important;
            }
            
            .goniometry-grid {
                grid-template-columns: 120px repeat(3, 100px);
                gap: 6px;
            }
            
            .form-grid {
                grid-template-columns: 1fr !important;
            }
            
            .edit-modal {
                width: 95vw;
                max-width: 95vw;
            }
            
            .edit-followup-header {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        
        <!-- Pantalla de Acceso Inicial -->
        <section id="accessScreen" class="section active">
            <div class="access-screen">
                <div class="app-header">
                    <h1>Sistema de Evaluación - Tendones Flexores</h1>
                    <p>Seguimiento de pacientes con lesiones en zonas I, II, III, IV y V</p>
                </div>
                
                <div class="access-buttons">
                    <button class="btn btn--primary" onclick="showSection('patientSection')">
                        Acceso Paciente
                    </button>
                    <button class="btn btn--secondary" onclick="showSection('doctorLogin')">
                        Acceso Médico
                    </button>
                </div>
            </div>
        </section>

        <!-- Login Médico -->
        <section id="doctorLogin" class="section">
            <div class="login-container">
                <div class="card">
                    <div class="card-header">
                        <h2>Acceso Médico</h2>
                    </div>
                    <div class="card-body">
                        <form id="doctorLoginForm">
                            <div class="form-group">
                                <label class="form-label">Número de Cédula</label>
                                <input type="text" id="doctorId" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nombre Completo</label>
                                <input type="text" id="doctorName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Contraseña</label>
                                <input type="password" id="doctorPassword" class="form-control" required>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn--primary">Ingresar</button>
                                <button type="button" class="btn btn--outline" onclick="showSection('accessScreen')">Volver</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección Paciente -->
        <section id="patientSection" class="section">
            <div class="section-header">
                <h2>Información para Pacientes</h2>
                <button class="btn btn--outline" onclick="showSection('accessScreen')">Volver</button>
            </div>
            
            <!-- Protocolos de Ejercicios -->
            <div class="card">
                <div class="card-header">
                    <h3>Protocolos de Ejercicios</h3>
                </div>
                <div class="card-body">
                    <div class="protocol-tabs">
                        <button class="tab-button active" onclick="showProtocol('KLEINERT')">KLEINERT</button>
                        <button class="tab-button" onclick="showProtocol('DURAN')">DURAN</button>
                        <button class="tab-button" onclick="showProtocol('ACTIVE_MOTION')">ACTIVE MOTION</button>
                    </div>
                    <div id="protocolContent" class="protocol-content">
                        <!-- Se llena dinámicamente -->
                    </div>
                </div>
            </div>

            <!-- Cuidados del Paciente -->
            <div class="card">
                <div class="card-header">
                    <h3>Cuidados del Paciente</h3>
                </div>
                <div class="card-body">
                    <div class="care-section">
                        <h4>Cuidados de Férula y Cicatriz</h4>
                        
                        <div class="care-subsection">
                            <h5>Cuidado de la Férula</h5>
                            <ul class="care-list">
                                <li>Mantener seca y limpia</li>
                                <li>No remover sin indicación médica</li>
                                <li>Revisar ajuste diariamente</li>
                                <li>Reportar dolor, hinchazón o cambios de color</li>
                                <li>No mojarse durante el baño</li>
                            </ul>
                        </div>
                        
                        <div class="care-subsection">
                            <h5>Cuidado de la Cicatriz</h5>
                            <ul class="care-list">
                                <li>Mantener área limpia y seca</li>
                                <li>Masaje cicatricial posterior a 3 semanas</li>
                                <li>Protección solar durante 6 meses</li>
                                <li>Aplicar crema hidratante suave</li>
                                <li>Evitar exposición a productos químicos</li>
                            </ul>
                        </div>
                        
                        <div class="care-subsection">
                            <h5>Signos de Alerta</h5>
                            <ul class="care-list">
                                <li>Aumento del dolor o inflamación</li>
                                <li>Enrojecimiento o calor en la herida</li>
                                <li>Secreción con mal olor</li>
                                <li>Fiebre mayor a 38°C</li>
                                <li>Pérdida súbita de movimiento</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard Médico -->
        <section id="dashboard" class="section">
            <div id="doctorInfo" class="doctor-info">
                <!-- Se llena dinámicamente -->
            </div>
            
            <header class="app-header">
                <h1>Sistema de Evaluación - Tendones Flexores</h1>
                <p>Panel de Control Médico</p>
            </header>

            <div class="dashboard-stats">
                <div class="card stat-card">
                    <div class="card-body">
                        <h3>Total Pacientes</h3>
                        <div class="stat-number" id="totalPacientes">0</div>
                    </div>
                </div>
                
                <div class="card stat-card">
                    <div class="card-body">
                        <h3>Controles Pendientes</h3>
                        <div class="stat-number" id="controlesPendientes">0</div>
                    </div>
                </div>
                
                <div class="card stat-card">
                    <div class="card-body">
                        <h3>Pacientes con Controles Incompletos</h3>
                        <div class="stat-number" id="pacientesIncompletos">0</div>
                    </div>
                </div>
            </div>

            <div class="search-section">
                <h3>Búsqueda de Pacientes</h3>
                <div class="search-form">
                    <input type="text" id="searchInput" class="form-control" placeholder="Buscar por nombre o número de documento">
                    <button class="btn btn--primary" onclick="searchPatients()">Buscar</button>
                </div>
                <div id="searchResults" class="search-results"></div>
            </div>

            <div class="action-buttons">
                <button class="btn btn--primary" onclick="showSection('nuevoPatient')">Nuevo Paciente</button>
                <button class="btn btn--secondary" onclick="showControlSelection()">Control de Seguimiento</button>
                <button class="btn btn--info" onclick="showClinicalHistories()">Historias Clínicas Completas</button>
                <button class="btn btn--success" onclick="showSection('editPatients')">Editar Pacientes</button>
                <button class="btn btn--outline" onclick="exportData()">Exportar Datos CSV</button>
                <button class="btn btn--outline" onclick="logout()">Cerrar Sesión</button>
            </div>

            <!-- Cronograma de Controles Postoperatorios -->
            <div class="card schedule-card">
                <div class="card-header">
                    <h3>Cronograma de Controles Postoperatorios</h3>
                </div>
                <div class="card-body">
                    <div class="postop-schedule">
                        <div class="postop-timeline">
                            <div class="postop-item">
                                <div class="postop-week">
                                    <h4>1-2 Semanas Post-cirugía</h4>
                                </div>
                                <div class="postop-activities">
                                    <ul>
                                        <li>Primera consulta - Retiro de suturas, evaluación de cicatrización</li>
                                        <li>Control inicial</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="postop-item">
                                <div class="postop-week">
                                    <h4>3-4 Semanas</h4>
                                </div>
                                <div class="postop-activities">
                                    <ul>
                                        <li>Inicio de movilización activa asistida</li>
                                        <li>Cambio de fase</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="postop-item">
                                <div class="postop-week">
                                    <h4>6 Semanas</h4>
                                </div>
                                <div class="postop-activities">
                                    <ul>
                                        <li>Evaluación de ROM, inicio de fortalecimiento</li>
                                        <li>Cambio de fase</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="postop-item">
                                <div class="postop-week">
                                    <h4>12 Semanas</h4>
                                </div>
                                <div class="postop-activities">
                                    <ul>
                                        <li>Evaluación final, alta médica</li>
                                        <li>Control final</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección Editar Pacientes -->
        <section id="editPatients" class="section">
            <div class="section-header">
                <h2>Editar Información de Pacientes</h2>
                <button class="btn btn--outline" onclick="showSection('dashboard')">Volver al Dashboard</button>
            </div>

            <div class="search-section">
                <div class="search-form">
                    <input type="text" id="editPatientSearch" class="form-control" placeholder="Buscar paciente por nombre o documento para editar">
                    <button class="btn btn--primary" onclick="searchPatientsForEdit()">Buscar</button>
                </div>
            </div>

            <div id="editPatientsList" class="edit-patients-list">
                <!-- Se llena dinámicamente -->
            </div>
        </section>

        <!-- Historias Clínicas Completas -->
        <section id="clinicalHistories" class="section">
            <div class="section-header">
                <h2>Historias Clínicas Completas</h2>
                <nav class="breadcrumb">
                    <span onclick="showSection('dashboard')" class="breadcrumb-link">Dashboard</span>
                    <span class="breadcrumb-separator">›</span>
                    <span class="breadcrumb-current">Historias Clínicas</span>
                </nav>
                <button class="btn btn--outline" onclick="showSection('dashboard')">Volver al Dashboard</button>
            </div>

            <div class="search-section">
                <div class="search-form">
                    <input type="text" id="clinicalHistorySearch" class="form-control" placeholder="Buscar paciente por nombre o documento">
                    <button class="btn btn--primary" onclick="searchClinicalHistories()">Buscar</button>
                </div>
            </div>

            <div id="clinicalHistoriesList" class="clinical-histories-list">
                <!-- Se llena dinámicamente -->
            </div>
        </section>

        <!-- Vista Individual de Historia Clínica -->
        <section id="individualClinicalHistory" class="section">
            <div class="section-header">
                <h2 id="clinicalHistoryPatientName">Historia Clínica</h2>
                <nav class="breadcrumb">
                    <span onclick="showSection('dashboard')" class="breadcrumb-link">Dashboard</span>
                    <span class="breadcrumb-separator">›</span>
                    <span onclick="showSection('clinicalHistories')" class="breadcrumb-link">Historias Clínicas</span>
                    <span class="breadcrumb-separator">›</span>
                    <span class="breadcrumb-current">Vista Individual</span>
                </nav>
                <div class="header-actions">
                    <button class="btn btn--primary" onclick="copyCompleteHistory()">Copiar Historia Clínica Completa</button>
                    <button class="btn btn--outline" onclick="showSection('clinicalHistories')">Volver a Lista</button>
                </div>
            </div>

            <div id="individualHistoryContent" class="individual-history-content">
                <!-- Se llena dinámicamente -->
            </div>
        </section>

        <!-- Nuevo Paciente -->
        <section id="nuevoPatient" class="section">
            <div class="section-header">
                <h2>Registro de Nuevo Paciente</h2>
                <button class="btn btn--outline" onclick="showSection('dashboard')">Volver al Dashboard</button>
            </div>

            <form id="newPatientForm" class="patient-form">
                <!-- Sección 1: Identificación -->
                <div class="card">
                    <div class="card-header">
                        <h3>1. Identificación del Paciente</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Fecha de Ingreso</label>
                                <input type="date" id="admissionDate" class="form-control" required onchange="calculateDaysToSurgery()">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Tiempo de Evolución hasta el ingreso (Horas)</label>
                                <input type="number" id="evolutionTime" class="form-control" min="0" required>
                            </div>

                            <div class="form-group col-span-2">
                                <label class="form-label">Nombre Completo</label>
                                <input type="text" id="fullName" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Tipo de Documento</label>
                                <select id="documentType" class="form-control" required>
                                    <option value="">Seleccionar</option>
                                    <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>
                                    <option value="Tarjeta de Identidad">Tarjeta de Identidad</option>
                                    <option value="Pasaporte">Pasaporte</option>
                                    <option value="Registro Civil">Registro Civil</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Número de Documento</label>
                                <input type="text" id="documentNumber" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Edad</label>
                                <input type="number" id="age" class="form-control" min="0" max="120" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Sexo</label>
                                <select id="sex" class="form-control" required>
                                    <option value="">Seleccionar</option>
                                    <option value="Masculino">Masculino</option>
                                    <option value="Femenino">Femenino</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Nivel Educativo</label>
                                <select id="educationLevel" class="form-control" required>
                                    <option value="">Seleccionar</option>
                                    <option value="Primaria">Primaria</option>
                                    <option value="Secundaria">Secundaria</option>
                                    <option value="Técnico">Técnico</option>
                                    <option value="Tecnólogo">Tecnólogo</option>
                                    <option value="Universitario">Universitario</option>
                                    <option value="Especialización">Especialización</option>
                                    <option value="Maestría">Maestría</option>
                                    <option value="Doctorado">Doctorado</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Ocupación Actual</label>
                                <input type="text" id="occupation" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">País de Origen</label>
                                <input type="text" id="originCountry" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Ciudad de Nacimiento</label>
                                <input type="text" id="birthCity" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Dirección</label>
                                <input type="text" id="address" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Departamento</label>
                                <input type="text" id="department" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Ciudad de Residencia</label>
                                <input type="text" id="city" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Teléfono de Contacto</label>
                                <input type="tel" id="phone" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Correo Electrónico</label>
                                <input type="email" id="email" class="form-control">
                            </div>

                            <div class="form-group">
                                <label class="form-label">EPS</label>
                                <input type="text" id="eps" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Tipo de Afiliación</label>
                                <select id="affiliationType" class="form-control" required>
                                    <option value="">Seleccionar</option>
                                    <option value="CONTRIBUTIVO">CONTRIBUTIVO</option>
                                    <option value="SUBSIDIADO">SUBSIDIADO</option>
                                    <option value="BENEFICIARIO">BENEFICIARIO</option>
                                    <option value="AFILIADO">AFILIADO</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Lateralidad</label>
                                <select id="laterality" class="form-control" required>
                                    <option value="">Seleccionar</option>
                                    <option value="Derecho">Derecho</option>
                                    <option value="Izquierdo">Izquierdo</option>
                                </select>
                            </div>

                            <!-- NUEVOS CAMPOS AGREGADOS -->
                            <div class="form-group">
                                <label class="form-label">Estrato</label>
                                <select id="estrato" class="form-control" required>
                                    <option value="">Seleccionar</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Religión</label>
                                <input type="text" id="religion" class="form-control">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Nombre del Acompañante</label>
                                <input type="text" id="companionName" class="form-control">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Relación con el Acompañante</label>
                                <input type="text" id="companionRelation" class="form-control">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Teléfono del Acompañante</label>
                                <input type="tel" id="companionPhone" class="form-control">
                            </div>

                            <div class="form-group col-span-2">
                                <label class="form-label">Comorbilidades Actuales</label>
                                <textarea id="comorbilidadesActuales" class="form-control" rows="3" placeholder="Describir comorbilidades actuales del paciente"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección 2: Datos Iniciales -->
                <div class="card">
                    <div class="card-header">
                        <h3>2. Datos Iniciales del Trauma</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-grid">
                            <!-- NUEVO CAMPO: Miembro lesionado -->
                            <div class="form-group">
                                <label class="form-label">Miembro Lesionado</label>
                                <select id="miembroLesionado" class="form-control" required>
                                    <option value="">Seleccionar</option>
                                    <option value="Izquierdo">Izquierdo</option>
                                    <option value="Derecho">Derecho</option>
                                </select>
                            </div>

                            <div class="form-group col-span-2">
                                <label class="form-label">Zonas Lesionadas - Seleccionar todas las que apliquen</label>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" id="zone1" value="I"> Zona I</label>
                                    <label><input type="checkbox" id="zone2" value="II"> Zona II</label>
                                    <label><input type="checkbox" id="zone3" value="III"> Zona III</label>
                                    <label><input type="checkbox" id="zone4" value="IV"> Zona IV</label>
                                    <label><input type="checkbox" id="zone5" value="V"> Zona V</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Objeto</label>
                                <input type="text" id="object" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Etiología</label>
                                <select id="etiology" class="form-control" required>
                                    <option value="">Seleccionar</option>
                                    <option value="CORTOPUNZANTE">CORTOPUNZANTE</option>
                                    <option value="CORTOCONTUNDENTE">CORTOCONTUNDENTE</option>
                                    <option value="APLASTAMIENTO">APLASTAMIENTO</option>
                                    <option value="EXPLOSIVO">EXPLOSIVO</option>
                                    <option value="CIZALLANTE">CIZALLANTE</option>
                                    <option value="COMBINADO">COMBINADO</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Mecanismo del Trauma</label>
                                <select id="traumaMechanism" class="form-control" required>
                                    <option value="">Seleccionar</option>
                                    <option value="ABIERTO">ABIERTO</option>
                                    <option value="CERRADO">CERRADO</option>
                                </select>
                            </div>

                            <div class="form-group col-span-2">
                                <label class="form-label">Descripción Prequirúrgica</label>
                                <textarea id="presurgicalDescription" class="form-control" rows="3"></textarea>
                            </div>

                            <div class="form-group col-span-2">
                                <label class="form-label">Tendón Flexor Comprometido</label>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" id="tendonfds" value="FDS"> FDS</label>
                                    <label><input type="checkbox" id="tendonfdp" value="FDP"> FDP</label>
                                    <label><input type="checkbox" id="tendonfpl" value="FPL"> FPL</label>
                                    <label><input type="checkbox" id="tendonfcu" value="FCU"> FCU</label>
                                    <label><input type="checkbox" id="tendonfcr" value="FCR"> FCR</label>
                                    <label><input type="checkbox" id="tendonpl" value="PL"> PL</label>
                                </div>
                            </div>

                            <div class="form-group col-span-2">
                                <label class="form-label">Descripción Tendón Flexor Comprometido</label>
                                <textarea id="tendonDescription" class="form-control" rows="3"></textarea>
                            </div>

                            <div class="form-group col-span-2">
                                <label class="form-label">Lesión Asociada General - Seleccionar todas las que apliquen</label>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" id="injurynervioso" value="NERVIOSO"> NERVIOSO</label>
                                    <label><input type="checkbox" id="injuryoseo" value="ÓSEO"> ÓSEO</label>
                                    <label><input type="checkbox" id="injuryvascular" value="VASCULAR"> VASCULAR</label>
                                    <label><input type="checkbox" id="injurymuscular" value="MUSCULAR"> MUSCULAR</label>
                                    <label><input type="checkbox" id="injuryligamentaria" value="LIGAMENTARIA"> LIGAMENTARIA</label>
                                    <label><input type="checkbox" id="injurycapsula" value="CÁPSULA ARTICULAR"> CÁPSULA ARTICULAR</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Lesión Asociada Específica</label>
                                <input type="text" id="specificAssociatedInjury" class="form-control">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Tenorrafia hilos</label>
                                <input type="text" id="tenorrhaphyThreads" class="form-control">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Reparación</label>
                                <select id="repairType" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="CENTRAL">CENTRAL</option>
                                    <option value="EPITENDINOSA">EPITENDINOSA</option>
                                    <option value="MIXTA">MIXTA</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Técnica Reparación</label>
                                <input type="text" id="repairTechnique" class="form-control">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Tenolisis</label>
                                <select id="tenolysis" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="Sí">Sí</option>
                                    <option value="No">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Días para Cirugía (Calculado automáticamente)</label>
                                <input type="number" id="daysToSurgery" class="form-control" readonly>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Fecha Quirúrgica</label>
                                <input type="date" id="surgeryDate" class="form-control" onchange="calculateDaysToSurgery()">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Escalas de Evaluación -->
                <div class="card">
                    <div class="card-header">
                        <h3>3. Escalas de Evaluación Inicial</h3>
                    </div>
                    <div class="card-body">
                        <h4>BMRC Scale - Sensitivo <span class="tooltip" title="Escala S0-S4. S0=Sin sensación, S1=Dolor profundo, S2=Dolor y tacto, S3=Discriminación 15-20mm, S4=Discriminación <7mm">ⓘ</span></h4>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Mediano</label>
                                <select id="bmrcSensoryMedian" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="0">S0 - Sin sensación</option>
                                    <option value="1">S1 - Sensación de dolor (profundo)</option>
                                    <option value="2">S2 - Sensación de dolor y tacto</option>
                                    <option value="2.5">S2+ - Sensación de dolor y tacto con cierta sobreacción</option>
                                    <option value="3">S3 - Como S2+, sin sobreacción y discriminación estática 15-20 mm</option>
                                    <option value="3.5">S3+ - Como S3, discriminación estática 7-15 mm</option>
                                    <option value="4">S4 - Como S3+, discriminación estática < 7 mm</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Cubital</label>
                                <select id="bmrcSensoryUlnar" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="0">S0 - Sin sensación</option>
                                    <option value="1">S1 - Sensación de dolor (profundo)</option>
                                    <option value="2">S2 - Sensación de dolor y tacto</option>
                                    <option value="2.5">S2+ - Sensación de dolor y tacto con cierta sobreacción</option>
                                    <option value="3">S3 - Como S2+, sin sobreacción y discriminación estática 15-20 mm</option>
                                    <option value="3.5">S3+ - Como S3, discriminación estática 7-15 mm</option>
                                    <option value="4">S4 - Como S3+, discriminación estática < 7 mm</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Radial</label>
                                <select id="bmrcSensoryRadial" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="0">S0 - Sin sensación</option>
                                    <option value="1">S1 - Sensación de dolor (profundo)</option>
                                    <option value="2">S2 - Sensación de dolor y tacto</option>
                                    <option value="2.5">S2+ - Sensación de dolor y tacto con cierta sobreacción</option>
                                    <option value="3">S3 - Como S2+, sin sobreacción y discriminación estática 15-20 mm</option>
                                    <option value="3.5">S3+ - Como S3, discriminación estática 7-15 mm</option>
                                    <option value="4">S4 - Como S3+, discriminación estática < 7 mm</option>
                                </select>
                            </div>
                        </div>

                        <h4>BMRC Scale - Motor <span class="tooltip" title="Escala M0-M5. M0=Sin contracción, M1=Contracción sin movimiento, M2=Movimiento sin gravedad, M3=Contra gravedad sin resistencia, M4=Con resistencia parcial, M5=Fuerza normal">ⓘ</span></h4>
                        
                        <div class="bmrc-motor-section">
                            <h5>FDS por Dedo</h5>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">FDS Dedo 2</label>
                                    <select id="bmrcMotorFds2" class="form-control">
                                        <option value="">Seleccionar</option>
                                        <option value="0">M0 - Sin contracción muscular</option>
                                        <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                        <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                        <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                        <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                        <option value="5">M5 - Fuerza muscular normal</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">FDS Dedo 3</label>
                                    <select id="bmrcMotorFds3" class="form-control">
                                        <option value="">Seleccionar</option>
                                        <option value="0">M0 - Sin contracción muscular</option>
                                        <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                        <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                        <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                        <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                        <option value="5">M5 - Fuerza muscular normal</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">FDS Dedo 4</label>
                                    <select id="bmrcMotorFds4" class="form-control">
                                        <option value="">Seleccionar</option>
                                        <option value="0">M0 - Sin contracción muscular</option>
                                        <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                        <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                        <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                        <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                        <option value="5">M5 - Fuerza muscular normal</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">FDS Dedo 5</label>
                                    <select id="bmrcMotorFds5" class="form-control">
                                        <option value="">Seleccionar</option>
                                        <option value="0">M0 - Sin contracción muscular</option>
                                        <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                        <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                        <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                        <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                        <option value="5">M5 - Fuerza muscular normal</option>
                                    </select>
                                </div>
                            </div>

                            <h5>FDP por Dedo</h5>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">FDP Dedo 2</label>
                                    <select id="bmrcMotorFdp2" class="form-control">
                                        <option value="">Seleccionar</option>
                                        <option value="0">M0 - Sin contracción muscular</option>
                                        <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                        <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                        <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                        <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                        <option value="5">M5 - Fuerza muscular normal</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">FDP Dedo 3</label>
                                    <select id="bmrcMotorFdp3" class="form-control">
                                        <option value="">Seleccionar</option>
                                        <option value="0">M0 - Sin contracción muscular</option>
                                        <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                        <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                        <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                        <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                        <option value="5">M5 - Fuerza muscular normal</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">FDP Dedo 4</label>
                                    <select id="bmrcMotorFdp4" class="form-control">
                                        <option value="">Seleccionar</option>
                                        <option value="0">M0 - Sin contracción muscular</option>
                                        <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                        <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                        <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                        <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                        <option value="5">M5 - Fuerza muscular normal</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">FDP Dedo 5</label>
                                    <select id="bmrcMotorFdp5" class="form-control">
                                        <option value="">Seleccionar</option>
                                        <option value="0">M0 - Sin contracción muscular</option>
                                        <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                        <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                        <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                        <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                        <option value="5">M5 - Fuerza muscular normal</option>
                                    </select>
                                </div>
                            </div>

                            <h5>Otros Músculos</h5>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">FPL</label>
                                    <select id="bmrcMotorFpl" class="form-control">
                                        <option value="">Seleccionar</option>
                                        <option value="0">M0 - Sin contracción muscular</option>
                                        <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                        <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                        <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                        <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                        <option value="5">M5 - Fuerza muscular normal</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">FCU</label>
                                    <select id="bmrcMotorFcu" class="form-control">
                                        <option value="">Seleccionar</option>
                                        <option value="0">M0 - Sin contracción muscular</option>
                                        <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                        <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                        <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                        <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                        <option value="5">M5 - Fuerza muscular normal</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">FCR</label>
                                    <select id="bmrcMotorFcr" class="form-control">
                                        <option value="">Seleccionar</option>
                                        <option value="0">M0 - Sin contracción muscular</option>
                                        <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                        <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                        <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                        <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                        <option value="5">M5 - Fuerza muscular normal</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">PL</label>
                                    <select id="bmrcMotorPl" class="form-control">
                                        <option value="">Seleccionar</option>
                                        <option value="0">M0 - Sin contracción muscular</option>
                                        <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                        <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                        <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                        <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                        <option value="5">M5 - Fuerza muscular normal</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn--primary">Guardar Paciente</button>
                    <button type="button" class="btn btn--secondary" onclick="showSection('dashboard')">Cancelar</button>
                </div>
            </form>
        </section>

        <!-- Control de Seguimiento -->
        <section id="followUpControl" class="section">
            <div class="section-header">
                <h2>Control de Seguimiento</h2>
                <button class="btn btn--outline" onclick="showSection('dashboard')">Volver al Dashboard</button>
            </div>

            <div id="patientSelection" class="patient-selection">
                <h3>Seleccionar Paciente</h3>
                <div class="search-form">
                    <input type="text" id="followUpSearch" class="form-control" placeholder="Buscar paciente por nombre o documento">
                    <button class="btn btn--primary" onclick="searchPatientsForFollowUp()">Buscar</button>
                </div>
                <div id="followUpSearchResults" class="search-results"></div>
            </div>

            <form id="followUpForm" class="patient-form hidden">
                <div class="card">
                    <div class="card-header">
                        <h3 id="selectedPatientName">Paciente Seleccionado</h3>
                        <div class="week-selection">
                            <label class="form-label">Semana de Control</label>
                            <select id="followUpWeek" class="form-control" required onchange="loadExistingFollowUp()">
                                <option value="">Seleccionar semana...</option>
                                <option value="1">Semana 1</option>
                                <option value="3">Semana 3</option>
                                <option value="6">Semana 6</option>
                                <option value="12">Semana 12</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Protocolo Usado</label>
                                <select id="protocolUsed" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="KLEINERT">KLEINERT</option>
                                    <option value="DURAN">DURAN</option>
                                    <option value="ACTIVE MOTION">ACTIVE MOTION</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Terapias Completas</label>
                                <select id="completeTherapies" class="form-control" onchange="toggleIncompleteReason()">
                                    <option value="">Seleccionar</option>
                                    <option value="true">Sí</option>
                                    <option value="false">No</option>
                                </select>
                            </div>

                            <!-- NUEVOS CAMPOS AGREGADOS -->
                            <div class="form-group">
                                <label class="form-label">Complicaciones</label>
                                <select id="complicaciones" class="form-control">
                                    <option value="">Ninguna</option>
                                    <option value="Dehiscencias">Dehiscencias</option>
                                    <option value="Ruptura">Ruptura</option>
                                    <option value="Infección">Infección</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Reintervención Quirúrgica</label>
                                <select id="reintervencionQuirurgica" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="Sí">Sí</option>
                                    <option value="No">No</option>
                                </select>
                            </div>

                            <div class="form-group col-span-2" id="incompleteReasonGroup" style="display: none;">
                                <label class="form-label">¿Por qué incompletas?</label>
                                <textarea id="incompleteReason" class="form-control" rows="2"></textarea>
                            </div>
                        </div>

                        <!-- Goniometría con cálculos automáticos TAM por dedo -->
                        <h4>Goniometría - Mediciones por Dedo <span class="tooltip" title="Medir grados de flexión en MCF, IFP, IFD de cada dedo">ⓘ</span></h4>
                        <div id="goniometryMeasurements" class="goniometry-grid">
                            <!-- Se genera dinámicamente -->
                        </div>

                        <div class="calculation-results">
                            <h4>Resultados TAM por Dedo</h4>
                            <div id="tamByFingerResults" class="tam-by-finger-results">
                                <!-- Se genera dinámicamente -->
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Strickland (%)</label>
                                    <input type="number" id="stricklandResult" class="form-control" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Clasificación Strickland</label>
                                    <input type="text" id="stricklandClassification" class="form-control" readonly>
                                </div>
                            </div>
                        </div>

                        <!-- Quick DASH Completo -->
                        <h4>Cuestionario QuickDASH <span class="tooltip" title="Cuestionario de 11 preguntas. Escala 1-5 cada pregunta. Se calcula automáticamente el puntaje total y grado de discapacidad">ⓘ</span></h4>
                        <div id="quickDashQuestions" class="quickdash-section">
                            <!-- Se genera dinámicamente -->
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Quick DASH (Calculado)</label>
                                <input type="number" id="quickDashScore" class="form-control" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Grado de Discapacidad</label>
                                <input type="text" id="dashDisabilityGrade" class="form-control" readonly>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Retorno a ocupación previa</label>
                                <select id="returnToPreviousOccupation" class="form-control" onchange="toggleReturnTimeField()">
                                    <option value="">Seleccionar</option>
                                    <option value="true">Sí</option>
                                    <option value="false">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Cambio de ocupación</label>
                                <select id="occupationChange" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="true">Sí</option>
                                    <option value="false">No</option>
                                    <option value="NO APLICA">NO APLICA</option>
                                </select>
                            </div>

                            <div class="form-group" id="returnTimeGroup" style="display: none;">
                                <label class="form-label">Tiempo retorno laboral (Meses)</label>
                                <input type="number" id="returnTimeMonths" class="form-control" min="0">
                            </div>
                        </div>

                        <!-- Escalas de Evaluación en el Control -->
                        <h4>BMRC Scale - Sensitivo <span class="tooltip" title="Escala S0-S4. S0=Sin sensación, S1=Dolor profundo, S2=Dolor y tacto, S3=Discriminación 15-20mm, S4=Discriminación <7mm">ⓘ</span></h4>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Mediano</label>
                                <select id="followUpBmrcSensoryMedian" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="0">S0 - Sin sensación</option>
                                    <option value="1">S1 - Sensación de dolor (profundo)</option>
                                    <option value="2">S2 - Sensación de dolor y tacto</option>
                                    <option value="2.5">S2+ - Sensación de dolor y tacto con cierta sobreacción</option>
                                    <option value="3">S3 - Como S2+, sin sobreacción y discriminación estática 15-20 mm</option>
                                    <option value="3.5">S3+ - Como S3, discriminación estática 7-15 mm</option>
                                    <option value="4">S4 - Como S3+, discriminación estática < 7 mm</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Cubital</label>
                                <select id="followUpBmrcSensoryUlnar" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="0">S0 - Sin sensación</option>
                                    <option value="1">S1 - Sensación de dolor (profundo)</option>
                                    <option value="2">S2 - Sensación de dolor y tacto</option>
                                    <option value="2.5">S2+ - Sensación de dolor y tacto con cierta sobreacción</option>
                                    <option value="3">S3 - Como S2+, sin sobreacción y discriminación estática 15-20 mm</option>
                                    <option value="3.5">S3+ - Como S3, discriminación estática 7-15 mm</option>
                                    <option value="4">S4 - Como S3+, discriminación estática < 7 mm</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Radial</label>
                                <select id="followUpBmrcSensoryRadial" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="0">S0 - Sin sensación</option>
                                    <option value="1">S1 - Sensación de dolor (profundo)</option>
                                    <option value="2">S2 - Sensación de dolor y tacto</option>
                                    <option value="2.5">S2+ - Sensación de dolor y tacto con cierta sobreacción</option>
                                    <option value="3">S3 - Como S2+, sin sobreacción y discriminación estática 15-20 mm</option>
                                    <option value="3.5">S3+ - Como S3, discriminación estática 7-15 mm</option>
                                    <option value="4">S4 - Como S3+, discriminación estática < 7 mm</option>
                                </select>
                            </div>
                        </div>

                        <!-- BMRC Scale Motor -->
                        <h4>BMRC Scale - Motor <span class="tooltip" title="Escala M0-M5. M0=Sin contracción, M1=Contracción sin movimiento, M2=Movimiento sin gravedad, M3=Contra gravedad sin resistencia, M4=Con resistencia parcial, M5=Fuerza normal">ⓘ</span></h4>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">FPL</label>
                                <select id="followUpBmrcMotorFpl" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="0">M0 - Sin contracción muscular</option>
                                    <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                    <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                    <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                    <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                    <option value="5">M5 - Fuerza muscular normal</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">FCU</label>
                                <select id="followUpBmrcMotorFcu" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="0">M0 - Sin contracción muscular</option>
                                    <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                    <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                    <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                    <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                    <option value="5">M5 - Fuerza muscular normal</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">FCR</label>
                                <select id="followUpBmrcMotorFcr" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="0">M0 - Sin contracción muscular</option>
                                    <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                    <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                    <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                    <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                    <option value="5">M5 - Fuerza muscular normal</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">PL</label>
                                <select id="followUpBmrcMotorPl" class="form-control">
                                    <option value="">Seleccionar</option>
                                    <option value="0">M0 - Sin contracción muscular</option>
                                    <option value="1">M1 - Contracción muscular que no resulta en movimiento articular</option>
                                    <option value="2">M2 - Contracción muscular con movimiento excluyendo gravedad</option>
                                    <option value="3">M3 - Contracción muscular efectiva contra gravedad pero no supera resistencia</option>
                                    <option value="4">M4 - Contracción muscular que supera cierta resistencia</option>
                                    <option value="5">M5 - Fuerza muscular normal</option>
                                </select>
                            </div>
                        </div>

                        <!-- Dinamómetro -->
                        <h4>Dinamómetro (lb)</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Izquierda</label>
                                <input type="number" id="dynamometerLeft" class="form-control" min="0" step="0.1" onchange="calculateDynamometerDifference()">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Derecha</label>
                                <input type="number" id="dynamometerRight" class="form-control" min="0" step="0.1" onchange="calculateDynamometerDifference()">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Diferencia</label>
                                <input type="number" id="dynamometerDifference" class="form-control" readonly>
                            </div>
                        </div>

                        <!-- Distancia Uña→Palma -->
                        <h4>Distancia Uña→Palma (mm) <span class="tooltip" title="Medir en mm desde la punta del dedo hasta la palma con flexión máxima">ⓘ</span></h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Dedo 2</label>
                                <input type="number" id="nailPalmDistance2" class="form-control" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Dedo 3</label>
                                <input type="number" id="nailPalmDistance3" class="form-control" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Dedo 4</label>
                                <input type="number" id="nailPalmDistance4" class="form-control" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Dedo 5</label>
                                <input type="number" id="nailPalmDistance5" class="form-control" min="0">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn--primary">Guardar Control</button>
                    <button type="button" class="btn btn--secondary" onclick="cancelFollowUp()">Cancelar</button>
                </div>
            </form>
        </section>

        <!-- Exercise Timer Modal -->
        <div id="exerciseTimerModal" class="modal hidden">
            <div class="modal-content exercise-modal">
                <div class="modal-header">
                    <h3 id="exerciseTitle">Ejercicio</h3>
                    <button class="btn btn--outline btn--sm" onclick="closeExerciseModal()">✕</button>
                </div>
                <div class="modal-body">
                    <div id="exerciseDescription" class="exercise-description"></div>
                    <div class="timer-display">
                        <div id="timerCircle" class="timer-circle">
                            <div id="timerText" class="timer-text">00:00</div>
                        </div>
                    </div>
                    <div class="timer-controls">
                        <button id="timerStartBtn" class="btn btn--primary" onclick="startTimer()">Iniciar</button>
                        <button id="timerPauseBtn" class="btn btn--secondary hidden" onclick="pauseTimer()">Pausar</button>
                        <button id="timerResetBtn" class="btn btn--outline" onclick="resetTimer()">Reiniciar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Modal -->
        <div id="editModal" class="modal hidden">
            <div class="modal-content edit-modal">
                <div class="modal-header">
                    <h3 id="editModalTitle">Editar Información</h3>
                    <button class="btn btn--outline btn--sm" onclick="closeEditModal()">✕</button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <div id="editFormContent"></div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn--primary">Guardar Cambios</button>
                            <button type="button" class="btn btn--secondary" onclick="closeEditModal()">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirmationModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Confirmar Cambios</h3>
                </div>
                <div class="modal-body">
                    <p id="confirmationMessage">¿Está seguro que desea guardar estos cambios?</p>
                    <div class="modal-actions">
                        <button class="btn btn--primary" onclick="confirmEdit()">Confirmar</button>
                        <button class="btn btn--secondary" onclick="cancelEdit()">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="spinner hidden">
            <div class="spinner-circle"></div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>